<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="ko">
<head>
  <meta charset="UTF-8">
  <title th:text="${profileUser != null ? profileUser.nickname + 'ë‹˜ì˜ í”„ë¡œí•„' : 'í”„ë¡œí•„'}">í”„ë¡œí•„</title>

  <!-- âœ… CSRF null-safe -->
  <meta name="_csrf" th:content="${_csrf?.token}"/>
  <meta name="_csrf_header" th:content="${_csrf?.headerName}"/>

  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 min-h-screen">

<!-- ğŸ” ë„¤ë¹„ê²Œì´ì…˜ ë°” -->
<nav class="bg-white shadow mb-8">
  <div class="max-w-6xl mx-auto px-4 py-3 flex justify-between items-center">
    <div class="text-xl font-bold text-gray-800">StyleMate</div>
    <div class="space-x-4 text-sm">
      <a href="/" class="text-gray-600 hover:text-black">ğŸ  í™ˆ</a>
      <a href="/feed/list" class="text-gray-600 hover:text-black">ğŸ“° ì „ì²´ í”¼ë“œ</a>
      <a th:href="@{/user/profile/{id}(id=${loginUserId})}" class="text-gray-600 hover:text-black">ğŸ‘¤ ë‚´ í”„ë¡œí•„</a>

      <!-- âœ… ë¡œê·¸ì•„ì›ƒì€ POST -->
      <form th:action="@{/logout}" method="post" class="inline">
        <input type="hidden" th:name="${_csrf?.parameterName}" th:value="${_csrf?.token}"/>
        <button type="submit" class="text-gray-600 hover:text-black">ğŸšª ë¡œê·¸ì•„ì›ƒ</button>
      </form>
    </div>
  </div>
</nav>

<!-- ğŸ‘¤ í”„ë¡œí•„ ì¹´ë“œ -->
<div class="w-full max-w-2xl mx-auto bg-white rounded-xl shadow-md p-8 space-y-6"
     th:with="imgUrl=${(profileUser != null and !#strings.isEmpty(profileUser.profileImage)) ? profileUser.profileImage : '/img/default.png'}">

  <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ + ë‹‰ë„¤ì„ -->
  <div class="flex items-center space-x-6">
    <img id="profileImage"
         th:src="${imgUrl}"
         alt="í”„ë¡œí•„ ì´ë¯¸ì§€"
         class="w-32 h-32 rounded-full border object-cover shadow cursor-pointer" />

    <div class="flex-1">
      <div class="flex justify-between items-center">
        <h2 class="text-2xl font-bold text-gray-800"
            th:text="${profileUser != null ? profileUser.nickname : 'ë‹‰ë„¤ì„'}">ë‹‰ë„¤ì„</h2>

        <a th:if="${profileUser != null and profileUser.id == loginUserId}"
           href="/user/edit"
           class="text-sm text-gray-500 hover:text-gray-800 hover:underline">
          âš™ï¸ í”„ë¡œí•„ ìˆ˜ì •
        </a>
      </div>

      <p class="text-base text-gray-500"
         th:text="${profileUser != null ? profileUser.email : ''}">ì´ë©”ì¼</p>
    </div>
  </div>

  <!-- ìê¸°ì†Œê°œ -->
  <div>
    <h3 class="text-lg font-semibold text-gray-700 mb-1">ì†Œê°œ</h3>
    <p class="text-base text-gray-700 whitespace-pre-wrap"
       th:text="${(profileUser != null and !#strings.isEmpty(profileUser.bio)) ? profileUser.bio : 'ì†Œê°œê¸€ì´ ì—†ìŠµë‹ˆë‹¤.'}"></p>
  </div>

  <!-- í”¼ë“œ ë³´ê¸° ë§í¬ + í”¼íŒ…ë£¸ ë²„íŠ¼ -->
<div class="flex justify-between items-center mt-4" th:if="${profileUser != null}">
  <a th:href="@{/feed/user/{id}(id=${profileUser.id})}"
     class="text-sm text-blue-600 hover:underline">
    ğŸ“¸ ì´ ì‚¬ëŒì˜ í”¼ë“œ ë³´ê¸°
  </a>

  <!-- âœ… ë³¸ì¸ì¼ ë•Œë§Œ í”¼íŒ…ë£¸ ë²„íŠ¼ í‘œì‹œ -->
  <a th:if="${profileUser.id == loginUserId}"
     th:href="@{'/user/profile/' + ${profileUser.id} + '/fittingroom'}"
     class="px-4 py-2 bg-indigo-600 text-white text-sm rounded-lg hover:bg-indigo-700">
     ğŸ§â€â™‚ï¸ ë‚´ FittingRoom ê°€ê¸°
  </a>
</div>
</div>

<!-- ğŸ–¼ï¸ í”„ë¡œí•„ ì´ë¯¸ì§€ í™•ëŒ€ ëª¨ë‹¬ -->
<div id="imageModal"
     class="fixed inset-0 bg-black bg-opacity-70 flex justify-center items-center z-50 hidden"
     onclick="closeImageModal()">
  <img id="modalImage"
       src=""
       class="max-w-[90%] max-h-[90%] border-4 border-white rounded-xl shadow-2xl" />
</div>

<!-- ğŸ“œ ëª¨ë‹¬ ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  const profileImg = document.getElementById("profileImage");
  const modal = document.getElementById("imageModal");
  const modalImg = document.getElementById("modalImage");

  if (profileImg && modal && modalImg) {
    profileImg.addEventListener("click", function () {
      modal.classList.remove("hidden");
      modalImg.src = this.src;
    });

    window.closeImageModal = function () {
      modal.classList.add("hidden");
    };
  }
</script>

</body>
</html>
